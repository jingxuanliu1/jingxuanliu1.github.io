<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ML Visualizations ‚Äî Neural Network & Lottery (Educational)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <style>
    :root{--bg:#0b0d10;--card:#12161b;--muted:#9fb2c8;--text:#e6eef8;--accent:#7aa2ff;}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(120deg,#0b0d10,#0f1320 60%);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0;position:sticky;top:0;background:rgba(11,13,16,.75);backdrop-filter:blur(8px);border-bottom:1px solid #1b2230;z-index:2}
    .brand{font-weight:800}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:#0b0d10;font-weight:700;border:none;cursor:pointer}
    .btn.ghost{background:#182035;color:#c7d6f3;border:1px solid #273352}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .card{background:var(--card);border:1px solid #1b2230;border-radius:16px;padding:14px;box-shadow:0 10px 28px rgba(0,0,0,.25);margin-top:16px}
    label{font-size:14px;color:var(--muted)}
    input[type="range"],input[type="number"],textarea{background:#0f1320;border:1px solid #1f2538;color:var(--text);padding:8px 10px;border-radius:10px}
    textarea{width:100%;resize:vertical;min-height:110px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    @media (max-width:1000px){.grid{grid-template-columns:1fr}}
    canvas{display:block;width:100%;height:auto;background:#0c1120;border:1px solid #1b2230;border-radius:14px}
    .muted{color:var(--muted)}
    .pill{background:#0f1423;border:1px solid #20273c;border-radius:999px;padding:6px 10px;font-size:13px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    footer{color:var(--muted);padding:28px 0 60px;text-align:center;border-top:1px solid #1b2230;margin-top:18px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">ML Visualizations ‚Äî Neural Network</div>
    <nav class="row">
      <a class="btn" href="/" aria-label="Back to home">‚Üê Back to Home</a>
    </nav>
  </header>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <label>Hidden layers</label>
        <input id="layers" type="range" min="1" max="4" value="2" />
        <label>Neurons/layer</label>
        <input id="neurons" type="range" min="2" max="64" value="16" />
        <label>Learning rate 10^<span id="lrOut">-2</span></label>
        <input id="lr" type="range" min="-4" max="-1" step="0.25" value="-2" />
        <label>Epochs/step</label>
        <input id="epochs" type="number" min="1" max="200" value="20" />
        <span class="pill" id="status">Ready</span>
      </div>
      <div class="row">
        <button class="btn ghost" id="rebuild">Rebuild</button>
        <button class="btn" id="train">Train ‚ñ∂</button>
        <button class="btn" id="auto">Auto</button>
        <button class="btn ghost" id="reset">Reset Loss</button>
      </div>
    </div>
    <p class="muted" style="margin:8px 0 0">Choose a dataset and watch the network learn. The ‚ÄúLottery‚Äù option is for education only ‚Äî lotteries are random; this does not predict real outcomes.</p>
  </div>

  <div class="grid">
    <div class="card">
      <h3 style="margin:6px 0 10px">Prediction vs Data</h3>
      <canvas id="plot" width="900" height="420" aria-label="regression plot"></canvas>
      <h3 style="margin:12px 0 10px">Training Loss</h3>
      <canvas id="loss" width="900" height="180" aria-label="loss plot"></canvas>
    </div>
    <div class="card">
      <h3 style="margin:6px 0 6px">Dataset</h3>
      <div class="row" style="gap:12px">
        <button class="btn ghost" data-ds="sine">Noisy Sine</button>
        <button class="btn ghost" data-ds="poly">Polynomial</button>
        <button class="btn ghost" data-ds="steps">Steps</button>
        <button class="btn" data-ds="lottery">‚ÄúLottery‚Äù</button>
      </div>
      <details style="margin-top:10px">
        <summary>Paste lottery-style draws (optional)</summary>
        <p class="muted" style="margin:6px 0 8px">One draw per line, numbers separated by space or comma. We train on the <em>average</em> per line to illustrate overfitting.</p>
        <textarea id="lotteryInput" class="mono" placeholder="e.g.\n10 15 33 46 55\n2, 19, 22, 38, 41\n..."></textarea>
        <div class="row" style="margin-top:8px">
          <button id="fitLottery" class="btn ghost">Use This Data</button>
          <button id="guessLottery" class="btn ghost">Make a Guess üé≤</button>
        </div>
        <div id="lotteryOut" class="mono" style="margin-top:6px"></div>
      </details>
      <h3 style="margin:14px 0 6px">Network Diagram</h3>
      <canvas id="net" width="320" height="260" aria-label="network diagram"></canvas>
    </div>
  </div>

  <footer>¬© <span id="year"></span> Jingxuan Liu ¬∑ Educational demo. No warranty or guarantees ‚Äî especially for lotteries.</footer>
</div>

<script>
  // ====== DOM ======
  const $ = s => document.querySelector(s);
  document.getElementById('year').textContent = new Date().getFullYear();

  const plot = $('#plot').getContext('2d');
  const lossC = $('#loss').getContext('2d');
  const netC  = $('#net').getContext('2d');

  // ====== Data generators (x -> y)
  const rndn = () => (Math.random()+Math.random()+Math.random()+Math.random()-2);
  const genSine = (n=200)=> tf.linspace(-3,3,n).arraySync().map(x=>({x, y: Math.sin(2*x)+0.25*rndn()}));
  const genPoly = (n=200)=> tf.linspace(-2,2,n).arraySync().map(x=>({x, y: 0.6*x*x*x - 0.8*x + 0.1 + 0.2*rndn()}));
  const genSteps= (n=200)=> tf.linspace(-3,3,n).arraySync().map(x=>({x, y: (x<-1?-1:x<1?0.2:1)+0.05*rndn()}));

  function parseLottery(text){
    const lines = text.trim().split(/\n+/).map(s=>s.trim()).filter(Boolean);
    return lines.map(line=> line.split(/[ ,\t]+/).map(Number).filter(Number.isFinite));
  }
  function lotteryToPts(text){
    const draws = parseLottery(text);
    if(!draws.length) return [];
    return draws.map((arr, i)=> ({x:i, y: arr.reduce((a,b)=>a+b,0)/arr.length}));
  }

  // ====== State ======
  let pts = genSine();
  let model=null, lossHist=[]; let auto=false;

  function rebuild(){
    const L = +$('#layers').value, H = +$('#neurons').value;
    const lr = Math.pow(10, +$('#lr').value);
    $('#lrOut').textContent = $('#lr').value;
    model = tf.sequential();
    model.add(tf.layers.dense({units:H, activation:'relu', inputShape:[1]}));
    for(let i=1;i<L;i++) model.add(tf.layers.dense({units:H, activation:'relu'}));
    model.add(tf.layers.dense({units:1}));
    model.compile({optimizer: tf.train.adam(lr), loss:'meanSquaredError'});
    lossHist=[]; drawLoss(); drawNet(L,H); setStatus(`Rebuilt L=${L}, H=${H}, lr=${lr.toExponential(1)}`);
  }

  async function trainStep(){
    if(!model) rebuild();
    const epochs = Math.max(1, +$('#epochs').value||20);
    const xs = tf.tensor2d(pts.map(p=>[p.x]));
    const ys = tf.tensor2d(pts.map(p=>[p.y]));
    const h = await model.fit(xs, ys, {epochs, batchSize:32, shuffle:true, verbose:0});
    const loss = h.history.loss.at(-1);
    lossHist.push(loss);
    drawLoss(); drawFit();
    setStatus(`Trained ${epochs} epoch(s), loss=${loss.toFixed(4)}`);
    xs.dispose(); ys.dispose();
  }

  function setStatus(s){ $('#status').textContent = s; }

  // ====== Drawing helpers ======
  function drawAxes(ctx,W=plot.canvas.width,H=plot.canvas.height){
    ctx.clearRect(0,0,W,H);
    ctx.strokeStyle = '#1e2a44'; ctx.lineWidth=1;
    // axes box
    ctx.strokeRect(40,10,W-50,H-40);
    // x/y lines
    ctx.beginPath(); ctx.moveTo(40, H-30); ctx.lineTo(W-10, H-30); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(40, 10); ctx.lineTo(40, H-30); ctx.stroke();
  }

  function drawFit(){
    const ctx=plot, W=ctx.canvas.width, H=ctx.canvas.height;
    drawAxes(ctx,W,H);
    if(!pts.length) return;
    const xs=pts.map(p=>p.x), ys=pts.map(p=>p.y);
    const xmin=Math.min(...xs), xmax=Math.max(...xs);
    const ymin=Math.min(-1.5,...ys), ymax=Math.max(1.5,...ys);
    const sx = x=> 40 + (x-xmin)/((xmax-xmin)||1)*(W-50);
    const sy = y=> (H-30) - (y-ymin)/((ymax-ymin)||1)*(H-40);

    // points
    ctx.fillStyle='rgba(122,162,255,0.9)';
    for(const p of pts){ ctx.beginPath(); ctx.arc(sx(p.x), sy(p.y), 2.5, 0, Math.PI*2); ctx.fill(); }

    // prediction curve
    if(model){
      const grid = tf.linspace(xmin, xmax, 200);
      const pred = model.predict(grid.reshape([200,1]));
      const py = pred.dataSync();
      ctx.strokeStyle='rgba(255,255,255,0.95)'; ctx.lineWidth=2; ctx.beginPath();
      grid.arraySync().forEach((x,i)=>{ const y=py[i]; if(i===0) ctx.moveTo(sx(x), sy(y)); else ctx.lineTo(sx(x), sy(y)); });
      ctx.stroke(); grid.dispose(); pred.dispose();
    }
  }

  function drawLoss(){
    const ctx=lossC, W=ctx.canvas.width, H=ctx.canvas.height;
    drawAxes(ctx,W,H);
    if(!lossHist.length) return;
    const xmax=lossHist.length-1, ymax=Math.max(...lossHist);
    const sx = x=> 40 + (x/(xmax||1))*(W-50);
    const sy = y=> (H-30) - (y/(ymax||1))*(H-40);
    ctx.strokeStyle='rgba(122,162,255,0.9)'; ctx.beginPath();
    lossHist.forEach((v,i)=>{ if(i===0) ctx.moveTo(sx(0), sy(v)); else ctx.lineTo(sx(i), sy(v)); });
    ctx.stroke();
  }

  function drawNet(L,Hn){
    const ctx=netC, W=ctx.canvas.width, H=ctx.canvas.height;
    ctx.clearRect(0,0,W,H);
    const layers=[1, ...Array(L).fill(Hn), 1];
    const top=16, bottom=H-16, left=20, right=W-20;
    const ly=(i,n)=> top + i*(bottom-top)/Math.max(1,n-1);
    const lx=j => left + j*(right-left)/(layers.length-1);
    ctx.strokeStyle='rgba(255,255,255,0.08)';
    for(let j=0;j<layers.length-1;j++){
      const n1=layers[j], n2=layers[j+1];
      for(let i=0;i<n1;i++) for(let k=0;k<n2;k++){
        ctx.beginPath(); ctx.moveTo(lx(j), ly(i,n1)); ctx.lineTo(lx(j+1), ly(k,n2)); ctx.stroke();
      }
    }
    ctx.fillStyle='rgba(122,162,255,0.9)';
    for(let j=0;j<layers.length;j++){
      const n=layers[j]; for(let i=0;i<n;i++){ ctx.beginPath(); ctx.arc(lx(j), ly(i,n), 5, 0, Math.PI*2); ctx.fill(); }
    }
  }

  // ====== Dataset switching & lottery helpers ======
  function setDataset(kind){
    if(kind==='sine') pts = genSine();
    if(kind==='poly') pts = genPoly();
    if(kind==='steps') pts = genSteps();
    if(kind==='lottery'){
      const txt = $('#lotteryInput').value.trim();
      const L = lotteryToPts(txt);
      pts = L.length ? L : Array.from({length:50}, (_,i)=>({x:i, y: 30 + 15*Math.sin(i/3) + 2*rndn()}));
    }
    lossHist=[]; drawFit(); drawLoss(); setStatus(`Dataset ‚Üí ${kind}`);
  }

  function guessLottery(text, count=5, maxNum=69){
    const draws = parseLottery(text); if(!draws.length) return [];
    const freq = new Map();
    for(const arr of draws) for(const n of arr) freq.set(n,(freq.get(n)||0)+1);
    const sorted = [...freq.entries()].sort((a,b)=>b[1]-a[1]).map(([n])=>n);
    const out=[]; for(const n of sorted){ if(out.length<count && n>=1 && n<=maxNum && !out.includes(n)) out.push(n); }
    while(out.length<count){ const n=1+Math.floor(Math.random()*maxNum); if(!out.includes(n)) out.push(n); }
    return out.sort((a,b)=>a-b);
  }

  // ====== Events ======
  document.querySelectorAll('[data-ds]').forEach(btn=> btn.addEventListener('click', e=> setDataset(e.target.dataset.ds)));
  $('#rebuild').addEventListener('click', rebuild);
  $('#train').addEventListener('click', trainStep);
  $('#auto').addEventListener('click', async ()=>{ auto=!auto; $('#auto').textContent = auto? 'Stop' : 'Auto'; while(auto){ await trainStep(); await new Promise(r=>setTimeout(r,60)); }});
  $('#reset').addEventListener('click', ()=>{ lossHist=[]; drawLoss(); setStatus('Loss reset'); });
  $('#layers').addEventListener('input', rebuild);
  $('#neurons').addEventListener('input', rebuild);
  $('#lr').addEventListener('input', ()=> $('#lrOut').textContent = $('#lr').value);
  $('#fitLottery').addEventListener('click', ()=>{ const L=lotteryToPts($('#lotteryInput').value); if(!L.length){ setStatus('Paste a few lines first'); return;} pts=L; lossHist=[]; rebuild(); drawFit(); drawLoss(); setStatus('Loaded lottery-style data');});
  $('#guessLottery').addEventListener('click', ()=>{ const g=guessLottery($('#lotteryInput').value); $('#lotteryOut').textContent = g.length? `Guessed numbers: ${g.join(', ')} (for fun only)` : 'Paste draws above first.'; });

  // ====== boot ======
  rebuild(); drawFit(); drawLoss();
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tasks — Jingxuan Liu</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0d10;--card:#12161b;--muted:#9fb2c8;--text:#e6eef8;--accent:#7aa2ff;--ok:#2ecc71;}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:linear-gradient(120deg,#0b0d10,#0f1320 60%)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0 8px;position:sticky;top:0;background:rgba(11,13,16,.75);backdrop-filter:blur(8px);border-bottom:1px solid #1b2230}
    .brand{font-weight:800}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--accent);color:#0b0d10;font-weight:700}
    h1{font-size:28px;margin:16px 0}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:20px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #1b2230;border-radius:16px;padding:16px;box-shadow:0 8px 28px rgba(0,0,0,.25)}
    .row{display:flex;gap:8px}
    input[type="text"]{flex:1;background:#0f1320;border:1px solid #1f2538;color:var(--text);padding:12px 14px;border-radius:12px;outline:none}
    button{background:var(--accent);color:#071225;font-weight:700;border:none;border-radius:12px;padding:12px 16px;cursor:pointer}
    button.ghost{background:#182035;color:#c7d6f3;border:1px solid #273352}
    ul{list-style:none;padding:0;margin:10px 0 0 0;display:flex;flex-direction:column;gap:8px}
    li{display:flex;align-items:center;gap:10px;background:#0f1423;border:1px solid #20273c;border-radius:12px;padding:10px 12px}
    li input[type="checkbox"]{transform:scale(1.2)}
    li .txt{flex:1}
    li .del{background:none;border:none;color:#ff6b6b;font-weight:800;cursor:pointer;padding:6px 10px;border-radius:8px}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .pill{background:#0f1423;border:1px solid #20273c;border-radius:999px;padding:8px 12px}
    .progressbar{height:10px;background:#1b2337;border-radius:999px;overflow:hidden;border:1px solid #233050}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--ok),#0dd3ff);transition:width .35s ease}
    .muted{color:var(--muted)}
    footer{color:var(--muted);padding:28px 0 60px;text-align:center;border-top:1px solid #1b2230;margin-top:28px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Tasks</div>
      <nav>
        <a href="/" class="btn" aria-label="Back to home">← Back to Home</a>
      </nav>
    </header>

    <h1>✅ Task Dashboard</h1>
    <div class="stats" aria-live="polite" aria-atomic="true">
      <div class="pill">Done: <b id="doneCount">0</b></div>
      <div class="pill">Total: <b id="totalCount">0</b></div>
      <div class="pill">Completion: <b id="pctDone">0%</b></div>
    </div>

    <section class="grid" style="margin-top:16px">
      <!-- Task list -->
      <div class="card" aria-labelledby="tasklist-h">
        <h2 id="tasklist-h" style="margin:0 0 10px 0">Task List</h2>
        <div class="row" role="form" aria-label="Add a task">
          <input id="newTaskInput" type="text" placeholder="Add a new task… (press Enter)" aria-label="Task text" />
          <button id="addBtn" aria-label="Add task">Add</button>
        </div>
        <ul id="taskList" role="list"></ul>
        <div class="row" style="margin-top:10px;align-items:center">
          <div class="progressbar" style="flex:1"><div id="bar" class="bar"></div></div>
          <button id="clearDoneBtn" class="ghost" aria-label="Clear completed tasks">Clear completed</button>
        </div>
        <p class="muted" style="margin-top:8px">Tip: Your tasks are saved locally in this browser.</p>
      </div>

      <!-- Chart -->
      <div class="card" aria-labelledby="chart-h">
        <h2 id="chart-h" style="margin:0 0 10px 0">Completion Chart</h2>
        <canvas id="progressChart" width="600" height="600" aria-label="Task completion doughnut chart" role="img"></canvas>
        <p class="muted" style="margin-top:8px">Updates live as you complete tasks.</p>
      </div>
    </section>

    <footer>
      © <span id="year"></span> Jingxuan Liu · Tasks
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Storage helpers
    const KEY = "myTasks.v1";
    const load = () => {
      try { return JSON.parse(localStorage.getItem(KEY)) || []; }
      catch { return []; }
    };
    const save = (tasks) => localStorage.setItem(KEY, JSON.stringify(tasks));

    // State
    const uid = () => Math.random().toString(36).slice(2,10);
    let tasks = load();

    // DOM
    const $list = document.getElementById("taskList");
    const $input = document.getElementById("newTaskInput");
    const $add = document.getElementById("addBtn");
    const $clearDone = document.getElementById("clearDoneBtn");
    const $done = document.getElementById("doneCount");
    const $total = document.getElementById("totalCount");
    const $pct = document.getElementById("pctDone");
    const $bar = document.getElementById("bar");

    // Chart with center text plugin
    const ctx = document.getElementById("progressChart").getContext("2d");
    const CenterText = {
      id: "centerText",
      afterDatasetsDraw(chart, args, pluginOpts) {
        const {ctx, chartArea:{width, height}} = chart;
        ctx.save();
        ctx.font = '700 28px Inter, system-ui, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#e6eef8';
        ctx.fillText((pluginOpts?.percent || 0) + '%', width/2, height/2);
        ctx.restore();
      }
    };
    let chart = new Chart(ctx, {
      type: "doughnut",
      data: { labels:["Done","Remaining"], datasets:[{ data:[0,1], borderWidth:0 }] },
      options: {
        responsive: true,
        cutout: "70%",
        plugins: { legend:{ position:"bottom" }, centerText:{ percent:0 } },
        animation: { duration: 300 }
      },
      plugins: [CenterText]
    });

    function renderTasks(){
      $list.innerHTML = "";
      tasks.forEach(t => {
        const li = document.createElement("li");
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!t.done;
        cb.addEventListener("change", () => {
          t.done = cb.checked;
          save(tasks);
          updateStatsAndChart();
          span.style.textDecoration = cb.checked ? "line-through" : "none";
        });

        const span = document.createElement("span");
        span.className = "txt";
        span.textContent = t.text;
        if (t.done) span.style.textDecoration = "line-through";

        const del = document.createElement("button");
        del.className = "del";
        del.title = "Delete task";
        del.textContent = "✕";
        del.addEventListener("click", () => {
          tasks = tasks.filter(x => x.id !== t.id);
          save(tasks);
          renderTasks();
          updateStatsAndChart();
        });

        li.appendChild(cb); li.appendChild(span); li.appendChild(del);
        $list.appendChild(li);
      });
    }

    function updateStatsAndChart(){
      const total = tasks.length;
      const done = tasks.filter(t => t.done).length;
      const pct = total === 0 ? 0 : Math.round(done / total * 100);

      $done.textContent = done;
      $total.textContent = total;
      $pct.textContent = pct + "%";
      $bar.style.width = pct + "%";

      chart.data.datasets[0].data = [done, Math.max(0,total-done)];
      chart.options.plugins.centerText.percent = pct;
      chart.update();
    }

    function addTaskFromInput(){
      const text = ($input.value || "").trim();
      if (!text) return;
      tasks.unshift({ id: uid(), text, done: false });
      $input.value = "";
      save(tasks);
      renderTasks();
      updateStatsAndChart();
      $input.focus();
    }

    // Events
    $add.addEventListener("click", addTaskFromInput);
    $input.addEventListener("keydown", (e)=>{ if (e.key === "Enter") addTaskFromInput(); });
    $clearDone.addEventListener("click", ()=>{
      tasks = tasks.filter(t => !t.done);
      save(tasks);
      renderTasks();
      updateStatsAndChart();
    });

    // Initial paint
    renderTasks();
    updateStatsAndChart();
  </script>
</body>
</html>
